###
# API Tests para SocgerFleet - CON PAGINACION, FILTROS Y BÚSQUEDA
###

# Variables
@baseUrl = http://localhost:3000
@contentType = application/json

# Tokens
@userToken  = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InRlc3RAc29jZ2VyZmxlZXQuY29tIiwic3ViIjoyLCJ1c2VybmFtZSI6InRlc3R1c2VyIiwicm9sZXMiOlt7ImlkIjoyLCJuYW1lIjoidXNlciIsImRlc2NyaXB0aW9uIjoiVXN1YXJpbyBiw4PCoXNpY28gZGVsIHNpc3RlbWEiLCJjcmVhdGVkQXQiOiIyMDI1LTA4LTI4VDA1OjEyOjMzLjM2NloiLCJ1cGRhdGVkQXQiOiIyMDI1LTA4LTI4VDA1OjEyOjMzLjQwMFoifV0sImlhdCI6MTc1NjQ4MjQyNiwiZXhwIjoxNzU2NTY4ODI2fQ.9IuaHpKeE0JtloNVcdNT8McqDoe8FV2N6iWEpwthv4s
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImFkbWluQHNvY2dlcmZsZWV0LmNvbSIsInN1YiI6MSwidXNlcm5hbWUiOiJhZG1pbiIsInJvbGVzIjpbeyJpZCI6MSwibmFtZSI6ImFkbWluIiwiZGVzY3JpcHRpb24iOiJBZG1pbmlzdHJhZG9yIGRlbCBzaXN0ZW1hIGNvbiB0b2RvcyBsb3MgcGVybWlzb3MiLCJjcmVhdGVkQXQiOiIyMDI1LTA4LTI4VDA1OjEyOjMzLjM2NloiLCJ1cGRhdGVkQXQiOiIyMDI1LTA4LTI4VDA1OjEyOjMzLjQwMFoifV0sImlhdCI6MTc1NjUzMjQ4MCwiZXhwIjoxNzU2NjE4ODgwfQ.NfngGVV3tupJ-sIXfD327gXGLh4fsabayelnsLOhlNk

###
# 1. REGISTRO DE USUARIO
POST {{baseUrl}}/auth/register
Content-Type: {{contentType}}

{
  "username": "testuser",
  "email": "test@socgerfleet.com",
  "password": "123456",
  "firstName": "Usuario",
  "lastName": "Prueba"
}

###
# 2. LOGIN DE USUARIO
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "test@socgerfleet.com",
  "password": "123456"
}

###
# 3. LOGIN ADMIN (usuario por defecto)
POST {{baseUrl}}/auth/login
Content-Type: {{contentType}}

{
  "email": "admin@socgerfleet.com",
  "password": "admin123"
}

###
# 4. OBTENER PERFIL (requiere token)
POST {{baseUrl}}/auth/profile
Authorization: Bearer {{userToken}}
Content-Type: {{contentType}}

###
# 4b. OBTENER PERFIL ADMIN
POST {{baseUrl}}/auth/profile
Authorization: Bearer {{adminToken}}
Content-Type: {{contentType}}

###
# 5. LISTAR TODOS LOS USUARIOS (con paginación por defecto)
GET {{baseUrl}}/users
Authorization: Bearer {{adminToken}}

###
# 5a. LISTAR USUARIOS - Primera página, 5 por página
GET {{baseUrl}}/users?page=1&limit=5
Authorization: Bearer {{adminToken}}

###
# 5b. LISTAR USUARIOS - Segunda página, 5 por página
GET {{baseUrl}}/users?page=2&limit=5
Authorization: Bearer {{adminToken}}

###
# 5c. LISTAR USUARIOS - Página específica con límite personalizado
GET {{baseUrl}}/users?page=1&limit=2
Authorization: Bearer {{adminToken}}

###
# 6. OBTENER USUARIO POR ID
GET {{baseUrl}}/users/1
Authorization: Bearer {{adminToken}}

###
# 7. CREAR NUEVO USUARIO (ADMIN)
POST {{baseUrl}}/users
Authorization: Bearer {{adminToken}}
Content-Type: {{contentType}}

{
  "username": "nuevouser",
  "email": "nuevo@socgerfleet.com",
  "password": "123456",
  "firstName": "Nuevo",
  "lastName": "Usuario",
  "roleIds": [2]
}

###
# 8. ACTUALIZAR USUARIO (ADMIN)
PATCH {{baseUrl}}/users/2
Authorization: Bearer {{adminToken}}
Content-Type: {{contentType}}

{
  "firstName": "Nombre Actualizado",
  "isActive": true
}

###
# 9. ASIGNAR ROL A USUARIO (ADMIN)
POST {{baseUrl}}/users/2/roles/1
Authorization: Bearer {{adminToken}}

###
# 10. QUITAR ROL DE USUARIO (ADMIN)
DELETE {{baseUrl}}/users/2/roles/1
Authorization: Bearer {{adminToken}}

###
# 11. ELIMINAR USUARIO (ADMIN)
DELETE {{baseUrl}}/users/4
Authorization: Bearer {{adminToken}}

###
# 12. LISTAR TODOS LOS ROLES (con paginación por defecto)
GET {{baseUrl}}/roles
Authorization: Bearer {{adminToken}}

###
# 12a. LISTAR ROLES - Primera página, 2 por página
GET {{baseUrl}}/roles?page=1&limit=2
Authorization: Bearer {{adminToken}}

###
# 12b. LISTAR ROLES - Segunda página, 2 por página
GET {{baseUrl}}/roles?page=2&limit=2
Authorization: Bearer {{adminToken}}

###
# 13. OBTENER ROL POR ID (ADMIN)
GET {{baseUrl}}/roles/1
Authorization: Bearer {{adminToken}}

###
# 14. CREAR NUEVO ROL (ADMIN)
POST {{baseUrl}}/roles
Authorization: Bearer {{adminToken}}
Content-Type: {{contentType}}

{
  "name": "editor",
  "description": "Editor de contenido"
}

###
# 15. ACTUALIZAR ROL (ADMIN)
PATCH {{baseUrl}}/roles/7
Authorization: Bearer {{adminToken}}
Content-Type: {{contentType}}

{
  "description": "Editor de contenido actualizado"
}

###
# 16. ELIMINAR ROL (ADMIN)
DELETE {{baseUrl}}/roles/7
Authorization: Bearer {{adminToken}}

###
# 17. VERIFICAR APLICACIÓN FUNCIONANDO
GET {{baseUrl}}

###
# NUEVOS ENDPOINTS CON FILTROS Y BÚSQUEDA - USUARIOS
###
# 18. BUSCAR USUARIOS - Búsqueda general
GET {{baseUrl}}/users?search=admin
Authorization: Bearer {{adminToken}}

###
# 19. FILTRAR USUARIOS - Por username
GET {{baseUrl}}/users?username=test
Authorization: Bearer {{adminToken}}

###
# 20. FILTRAR USUARIOS - Por email
GET {{baseUrl}}/users?email=admin@socger
Authorization: Bearer {{adminToken}}

###
# 21. FILTRAR USUARIOS - Por nombre completo
GET {{baseUrl}}/users?firstName=Usuario&lastName=Prueba
Authorization: Bearer {{adminToken}}

###
# 22. FILTRAR USUARIOS - Por estado activo
GET {{baseUrl}}/users?isActive=true
Authorization: Bearer {{adminToken}}

###
# 23. FILTRAR USUARIOS - Por rol específico
GET {{baseUrl}}/users?roleName=admin
Authorization: Bearer {{adminToken}}

###
# 24. FILTRAR USUARIOS - Por ID de rol
GET {{baseUrl}}/users?roleId=1
Authorization: Bearer {{adminToken}}

###
# 25. FILTRAR USUARIOS - Por rango de fechas
GET {{baseUrl}}/users?createdFrom=2025-08-28&createdTo=2025-08-30
Authorization: Bearer {{adminToken}}

###
# 26. FILTRAR USUARIOS - Ordenar por username ASC
GET {{baseUrl}}/users?sortBy=username&sortOrder=ASC
Authorization: Bearer {{adminToken}}

###
# 27. FILTRAR USUARIOS - Combinación de filtros
GET {{baseUrl}}/users?search=test&isActive=true&sortBy=createdAt&sortOrder=DESC&page=1&limit=5
Authorization: Bearer {{adminToken}}

###
# 28. BÚSQUEDA RÁPIDA DE USUARIOS
GET {{baseUrl}}/users/search?q=admin&limit=5
Authorization: Bearer {{adminToken}}

###
# NUEVOS ENDPOINTS DE FILTROS PARA ROLES
###

###
# 29. BUSCAR ROLES - Búsqueda general
GET {{baseUrl}}/roles?search=admin
Authorization: Bearer {{adminToken}}

###
# 30. FILTRAR ROLES - Por nombre específico
GET {{baseUrl}}/roles?name=admin
Authorization: Bearer {{adminToken}}

###
# 31. FILTRAR ROLES - Por descripción
GET {{baseUrl}}/roles?description=sistema
Authorization: Bearer {{adminToken}}

###
# 32. FILTRAR ROLES - Por rango de fechas
GET {{baseUrl}}/roles?createdFrom=2025-08-28&createdTo=2025-08-30
Authorization: Bearer {{adminToken}}

###
# 33. FILTRAR ROLES - Por cantidad mínima de usuarios
GET {{baseUrl}}/roles?minUsers=1
Authorization: Bearer {{adminToken}}

###
# 34. FILTRAR ROLES - Por cantidad máxima de usuarios
GET {{baseUrl}}/roles?maxUsers=2
Authorization: Bearer {{adminToken}}

###
# 35. FILTRAR ROLES - Ordenar por cantidad de usuarios
GET {{baseUrl}}/roles?sortBy=userCount&sortOrder=DESC
Authorization: Bearer {{adminToken}}

###
# 36. FILTRAR ROLES - Combinación de filtros
GET {{baseUrl}}/roles?search=user&minUsers=1&sortBy=name&sortOrder=ASC&page=1&limit=10
Authorization: Bearer {{adminToken}}

###
# 37. BÚSQUEDA RÁPIDA DE ROLES
GET {{baseUrl}}/roles/search?q=admin&limit=3
Authorization: Bearer {{adminToken}}

